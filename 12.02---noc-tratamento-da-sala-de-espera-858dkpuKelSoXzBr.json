{"updatedAt":"2025-11-27T12:20:57.000Z","createdAt":"2025-11-25T20:21:18.605Z","id":"858dkpuKelSoXzBr","name":"12.02 - NOC Tratamento da sala de espera","active":false,"isArchived":true,"nodes":[{"parameters":{"rule":{"interval":[{"field":"minutes"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[0,0],"id":"b3b7cb6c-7647-44c9-a275-0730c3564f4c","name":"Schedule Trigger"},{"parameters":{"authentication":"serviceAccount","documentId":{"__rl":true,"value":"11ynejkll5Q6J6AJ--R3sIxLMyyd3AbTaTS9ncm1KQMs","mode":"list","cachedResultName":"Dados_automação ","cachedResultUrl":"https://docs.google.com/spreadsheets/d/11ynejkll5Q6J6AJ--R3sIxLMyyd3AbTaTS9ncm1KQMs/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":22012169,"mode":"list","cachedResultName":"rotina_quedas","cachedResultUrl":"https://docs.google.com/spreadsheets/d/11ynejkll5Q6J6AJ--R3sIxLMyyd3AbTaTS9ncm1KQMs/edit#gid=22012169"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.7,"position":[208,0],"id":"004e9230-5c8a-4b6c-8840-7e77d7e604df","name":"Get row(s) in sheet","credentials":{"googleApi":{"id":"G23Xn5Fl7KzKph4r","name":"Google Service Account account"}}},{"parameters":{"jsCode":"// Obtém o primeiro item da entrada, que contém o array 'quedas'\nconst input = items[0].json;\nconst quedas = input.quedas;\n\n// Objeto para armazenar os grupos, onde a chave é o grupoId\nconst grouped = {};\n\n// 1. Percorre o array 'quedas'\nfor (const item of quedas) {\n    const grupoId = item.grupoId;\n\n    // 2. Se o grupoId ainda não existe no objeto 'grouped',\n    // inicializa-o com um array vazio\n    if (!grouped[grupoId]) {\n        grouped[grupoId] = [];\n    }\n\n    // 3. Adiciona o item atual ao array do grupo correspondente\n    grouped[grupoId].push(item);\n}\n\n// 4. Converte o objeto agrupado em um array de objetos para a saída do n8n\n// O formato de saída será um array, onde cada elemento representa um grupo\n// e o array 'quedas' de cada grupo contém todos os itens daquele grupo.\nconst output = [];\nfor (const grupoId in grouped) {\n    // É importante manter o formato de saída como um objeto\n    // que encapsula o array de quedas, semelhante à sua estrutura original,\n    // mas também podemos incluir o grupoId e nome do grupo no nível superior.\n    \n    // Pega o nome do grupo do primeiro item (todos no grupo terão o mesmo)\n    const nomeDoGrupo = grouped[grupoId][0][\"nome do grupo\"]; \n    \n    output.push({\n        json: {\n            grupoId: parseInt(grupoId), // Converte a chave (string) de volta para número\n            nomeDoGrupo: nomeDoGrupo,\n            quedas: grouped[grupoId]\n        }\n    });\n}\n\n// Retorna o array de saída\nreturn output;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[624,0],"id":"1d675c39-cc88-4df9-a114-d87001aadfec","name":"Separa em grupos"},{"parameters":{"aggregate":"aggregateAllItemData","destinationFieldName":"quedas","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[416,0],"id":"76fac7b6-899b-4ba2-88b7-7b2ca5c797ab","name":"Aggregate"}],"connections":{"Schedule Trigger":{"main":[[{"node":"Get row(s) in sheet","type":"main","index":0}]]},"Get row(s) in sheet":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Separa em grupos","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"317c5fb2-75e6-4676-abc5-af2b687e5cc2","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-25T20:21:18.615Z","createdAt":"2025-11-25T20:21:18.615Z","role":"workflow:owner","workflowId":"858dkpuKelSoXzBr","projectId":"UcF1WBdewsFeRVFr"}],"activeVersion":null,"tags":[]}